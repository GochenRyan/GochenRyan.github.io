---
title: ã€æ¸¸æˆå®¢æˆ·ç«¯ã€‘äº‹ä»¶åˆ†å‘ï¼ˆ1ï¼‰
id: 11
date: 2020-07-06 23:30:45
tags:
    - æ¸¸æˆå®¢æˆ·ç«¯
    - cocos2dx
    - äº‹ä»¶åˆ†å‘
categories: æ¸¸æˆå®¢æˆ·ç«¯
---

## å‰è¨€
æœ€è¿‘å»äº†ä¸€è¶Ÿä¸Šæµ·ï¼Œå›æ¥æ›´æ–°å¥åº·ä¿¡æ¯ï¼Œemmmï¼Œ7å¤©å•äººå…¬å¯“éš”ç¦»å¥—é¤ğŸ˜€ã€‚è¶ç€è¿œç¨‹åŠå…¬è¿™æ®µæ—¶é—´ï¼Œçœ‹äº†çœ‹cocos2dx4.0æºç æ¯”è¾ƒæ„Ÿå…´è¶£çš„ä¸€äº›æ¨¡å—ï¼Œè¿™ç¯‡å” å” cocos2dxä¸­çš„äº‹ä»¶åˆ†å‘ã€‚psï¼šé¡ºä¾¿ä¸€æï¼Œæ˜¯å“ªä¸ªå°å¤©æ‰æƒ³åˆ°çš„åœ¨å…¬å¯“2æ¥¼å¼€KTVã€‚å•Šï¼Œå¤±çœ ï¼Œå¤±çœ æ˜¯æˆ‘çš„å…»æ–™ã€‚

<!-- more -->

## é—®é¢˜å¯¼è¯»
<form>
<input type="checkbox">ä»€ä¹ˆæ˜¯äº‹ä»¶ï¼Ÿ
<input type="checkbox">ä»€ä¹ˆæ˜¯äº‹ä»¶åˆ†å‘ï¼Ÿæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ
<input type="checkbox">é‡‡ç”¨äº†ä»€ä¹ˆæ¨¡å¼ï¼Ÿè¯¥æ¨¡å¼æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ
<input type="checkbox">äº‹ä»¶åˆ†å‘æ¶‰åŠåˆ°å“ªäº›å…ƒç´ ï¼Ÿ
<input type="checkbox">æ˜¯å¦‚ä½•åˆ†å‘ç³»ç»Ÿäº‹ä»¶ã€è‡ªå®šä¹‰äº‹ä»¶çš„ï¼Ÿ
<input type="checkbox">æœ‰å“ªäº›ç³»ç»Ÿäº‹ä»¶ï¼Ÿ
<input type="checkbox">äº‹ä»¶åˆ†å‘æ˜¯å¦‚ä½•æ’åºçš„ï¼Ÿ
<input type="checkbox">äº‹ä»¶åˆ†å‘æ˜¯å¦‚ä½•åµŒå¥—çš„ï¼Ÿ
<input type="checkbox">äº‹ä»¶åˆ†å‘æ˜¯å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Ÿ
<input type="checkbox">èƒ½Debugè¿‡ä¸€éæµç¨‹å—ï¼Ÿ
<input type="checkbox">å¯ä»¥ç”¨pythonç®€å•å®ç°å—ï¼Ÿ
</form>

## äº‹ä»¶
åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±äº**ç©å®¶çš„è¾“å…¥**æˆ–è€…**ç¨‹åºå†…éƒ¨æŸä¸ªå¤„ç†é€»è¾‘å®Œæˆ**ï¼Œéœ€è¦ç­‰å¾…**å…¶ä»–æ¨¡å—**é’ˆå¯¹è¯¥è¡Œä¸ºè¿›è¡Œä¸€äº›**å“åº”æ“ä½œ**çš„æ—¶å€™ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªäº‹ä»¶ã€‚ä¸ä¸€èˆ¬çš„**ç›´æ¥è°ƒç”¨**ç›¸æ¯”ï¼Œäº‹ä»¶å¯ä»¥ä¸ç”¨ä¾èµ–äº‹ä»¶å“åº”è€…çš„å®ç°ï¼Œè€Œæ˜¯é¢„å…ˆå®šä¹‰ä¸€ç»„äº‹ä»¶ç±»å‹ï¼Œäº‹ä»¶çš„å“åº”è€…ç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ·»åŠ æˆ–åˆ é™¤ã€‚

## è®¢é˜…è€…æ¨¡å¼
è®¢é˜…è€…æ¨¡å¼å°†äº‹ä»¶çš„**è§¦å‘è€…**å’Œ**å“åº”è€…**åˆ†å¼€ï¼Œäº‹ä»¶çš„è§¦å‘è€…åªæ˜¯å‘ä¸€ä¸ªå…¬å…±çš„**äº‹ä»¶åˆ†å‘å™¨**å‘é€ä¸€ä¸ª**äº‹ä»¶æ¶ˆæ¯**ï¼Œè€Œäº‹ä»¶çš„å“åº”è€…å‘äº‹ä»¶åˆ†å‘å™¨è®¢é˜…ä¸€ä¸ªç±»å‹çš„æ¶ˆæ¯æ¥å“åº”äº‹ä»¶ã€‚å¦‚æœæŸä¸ªç±»å‹çš„äº‹ä»¶æ²¡æœ‰ä»»ä½•è®¢é˜…è€…ï¼Œåˆ™è¯¥äº‹ä»¶ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚

## åŸºæœ¬å…ƒç´ 
- äº‹ä»¶ç›‘å¬å™¨ï¼šè´Ÿè´£æ¥æ”¶äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œé¢„å®šä¹‰çš„äº‹ä»¶å¤„ç†å‡½æ•°
- äº‹ä»¶åˆ†å‘å™¨ï¼šè´Ÿè´£å‘èµ·é€šçŸ¥
- äº‹ä»¶å¯¹è±¡ï¼šè®°å½•äº‹ä»¶çš„ç›¸å…³ä¿¡æ¯

## ç›¸å…³æ–‡ä»¶
åˆ—ä¸€ä¸‹æ¶‰åŠåˆ°çš„ä¸€äº›æ–‡ä»¶  
![file](/img/EventDispatcher/1.png)

## äº‹ä»¶æœºåˆ¶çš„å·¥ä½œæµç¨‹

![event](/img/EventDispatcher/2.png)

1. æ¨¡å—Bå‘äº‹ä»¶åˆ†å‘å™¨æ³¨å†Œä¸€ä¸ªè®¢é˜…è€…listenerbï¼Œè¡¨æ˜è‡ªå·±éœ€è¦å¤„ç†typeAç±»å‹çš„äº‹ä»¶æ¶ˆæ¯ï¼Œlistenerbä¸­å¸¦æœ‰å¤„ç†äº‹ä»¶çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•åœ°å€func
2. æ¨¡å—Aåœ¨äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œä¼šå‘äº‹ä»¶åˆ†å‘å™¨å‘å‡ºç±»å‹ä¸ºtypeAçš„äº‹ä»¶æ¶ˆæ¯é€šçŸ¥ï¼Œå¹¶ä¼ å…¥ä¸€äº›äº‹ä»¶å‚æ•°args
3. äº‹ä»¶åˆ†å‘å™¨åœ¨æ¥æ”¶åˆ°äº‹ä»¶æ¶ˆæ¯ä¹‹åï¼Œä»è®¢é˜…è€…åˆ—è¡¨ä¸­æŸ¥æ‰¾è®¢é˜…è€…listenerbåº”è¯¥å“åº”å“ªäº›äº‹ä»¶ï¼Œåˆ™è§¦å‘listenerbçš„å›è°ƒå‡½æ•°funcï¼Œå¹¶ä¼ å…¥äº‹ä»¶å‚æ•°args

## äº‹ä»¶ç³»ç»Ÿçš„ç‰¹ç‚¹
- äº‹ä»¶ç³»ç»Ÿä½¿å¾—ç³»ç»Ÿæˆ–ä¸­é—´ä»¶å¯ä»¥æå‰é¢„å®šä¹‰ä¸€äº›äº‹ä»¶
- è§£è€¦ï¼Œä½¿å¾—æ¨¡å—ä¹‹é—´æ›´åŠ ç‹¬ç«‹
- ä¸€ä¸ªäº‹ä»¶å¯ä»¥å¯¹åº”å¤šä¸ªè®¢é˜…è€…ï¼Œå¤šä¸ªè®¢é˜…è€…å¯ä»¥å¯¹ä¸€ä¸ªäº‹ä»¶æºè¿›è¡Œå“åº”ï¼Œä»¥æ‰§è¡Œä¸åŒèŒèƒ½ä¸Šçš„é€»è¾‘å¤„ç†
- å¯¹äºæ€§èƒ½è¦æ±‚éå¸¸é«˜çš„éƒ¨åˆ†ï¼Œä¸é€‚åˆç”¨äº‹ä»¶åˆ†å‘ï¼Œå› ä¸ºäº‹ä»¶åˆ†å‘ä¼šåšä¸€äº›æŸ¥è¯¢ã€æ’åºç­‰æ“ä½œï¼Œä¼šå½±å“å®æ—¶æ€§èƒ½

## è®¢é˜…è€…
åœ¨cocos2dxä¸­ï¼Œä¸€ä¸ªè®¢é˜…è€…æ˜¯ä¸€ä¸ª**EventListener**çš„å­ç±»ã€‚æ¯ä¸ªEventListenerç”±ä¸€ä¸ª**å›è°ƒå‡½æ•°**ã€ä¸€ä¸ª**è®¢é˜…è€…ç±»å‹type**ä»¥åŠä¸€ä¸ª**listenerID**ç»„æˆã€‚äº‹ä»¶åˆ†å‘å™¨èƒ½å¤Ÿæ ¹æ®äº‹ä»¶çš„ç±»å‹æ‰¾åˆ°å¯¹åº”çš„listenerIDï¼Œè¿›è€Œæ‰¾åˆ°æ‰€æœ‰å¤„ç†è¯¥äº‹ä»¶çš„è®¢é˜…è€…ã€‚
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

```cpp
class CC_DLL EventListener : public Ref
{
public:
    /** Type Event type.*/
    enum class Type
    {
        UNKNOWN,
        TOUCH_ONE_BY_ONE,
        TOUCH_ALL_AT_ONCE,
        KEYBOARD,
        MOUSE,
        ACCELERATION,
        FOCUS,
        GAME_CONTROLLER,
        CUSTOM
    };

    typedef std::string ListenerID;

CC_CONSTRUCTOR_ACCESS:
    bool init(Type t, const ListenerID& listenerID, const std::function<void(Event*)>& callback);

protected:
    Type getType() const { return _type; }
    const ListenerID& getListenerID() const { return _listenerID; }
    std::function<void(Event*)> _onEvent;
    typedef std::string _listenerID;   
};
```

</details>

äº‹ä»¶åˆ†å‘å™¨EventDispatcherèƒ½æ ¹æ®äº‹ä»¶çš„ç±»å‹æ‰¾åˆ°å¯¹åº”çš„listenerIDï¼Œè¿›è€Œæ‰¾åˆ°æ‰€æœ‰å¤„ç†è¯¥äº‹ä»¶çš„è®¢é˜…è€…ã€‚  
è¿™é‡Œæœ‰ä¸¤ç§ç±»å‹ï¼š
- **type**ï¼šç”¨æ¥åŒºåˆ†EventListenerç±»å‹
- **listenerID**ï¼šå¯¹åº”ä¸€ä¸ªäº‹ä»¶æºï¼Œå¯ä»¥æ ¹æ®ä¸€ä¸ªäº‹ä»¶æºçš„ç±»å‹æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„listenerID

typeåªæœ‰7ç§ç±»å‹ï¼Œè€ŒlistenerIDæ ¹æ®è‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹åœ¨æ•°é‡ä¸Šæ›´å¤šï¼š

| EventListener::Type | listenerID             | æè¿°      |
| ------------------- | ---------------------- | ------- |
| TOUCH_ONE_BY_ONE    | __cc_touch_one_by_one  | å•ç‚¹è§¦æ‘¸    |
| TOUCH_ALL_AT_ONCE   | __cc_touch_all_at_once | å¤šç‚¹è§¦æ‘¸    |
| KEYBOARD            | __cc_keyboard          | é”®ç›˜äº‹ä»¶    |
| MOUSE               | __cc_mouse             | é¼ æ ‡äº‹ä»¶    |
| ACCELERATION        | __cc_acceleration      | é‡åŠ›åŠ é€Ÿåº¦äº‹ä»¶ |
| FOCUS               | __cc_focus_event       | ç„¦ç‚¹äº‹ä»¶    |
| GAME_CONTROLLER     | __cc_controller        | æ¸¸æˆæ‰‹æŸ„äº‹ä»¶  |
| CUSTOM              | eventName              | è‡ªå®šä¹‰äº‹ä»¶   |

## äº‹ä»¶ç±»å‹
ä¸€ä¸ªäº‹ä»¶ç”¨ä¸€ä¸ªEventçš„å­ç±»æè¿°ï¼Œå®ƒä¹Ÿæ˜¯äº‹ä»¶åˆ†å‘åˆ°è®¢é˜…è€…æ—¶äº‹ä»¶æºä¼ é€’ç»™è®¢é˜…è€…çš„å‚æ•°ã€‚Eventçš„å­ç±»ç”±ä¸€ä¸ªç±»å‹Event::Typeå’Œä¸€äº›äº‹ä»¶æ•°æ®ç»„æˆã€‚

```cpp
class CC_DLL Event : public Ref
{
public:
    enum class Type
    {
        TOUCH,
        KEYBOARD,
        ACCELERATION,
        MOUSE,
        FOCUS,
        GAME_CONTROLLER,
        CUSTOM
    };

CC_CONSTRUCTOR_ACCESS:
    Event(Type type);

public:
    Type getType() const { return _type; }    
};
```

Event::Typeå¯ä»¥ç”¨æ¥æŸ¥æ‰¾listenerIDï¼Œä»è€Œå°†äº‹ä»¶åˆ†å‘åˆ°æ­£ç¡®çš„è®¢é˜…è€…è¿›è¡Œå¤„ç†ã€‚Event::Typeä¸listenerIDçš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| EventListener::Type | listenerID                                   | æè¿°                             |
| ------------------- | -------------------------------------------- | ------------------------------ |
| TOUCH               | __cc_touch_one_by_oneã€__cc_touch_all_at_once | è§¦æ‘¸äº‹ä»¶å¯¹åº”ä¸¤ä¸ªlistenerIDï¼Œè§¦æ‘¸äº‹ä»¶è¢«ç‰¹æ®Šå¤„ç†   |
| KEYBOARD            | __cc_keyboard                                | æŒ‰é”®äº‹ä»¶                           |
| MOUSE               | __cc_mouse                                   | é¼ æ ‡äº‹ä»¶                           |
| ACCELERATION        | __cc_acceleration                            | é‡åŠ›åŠ é€Ÿåº¦äº‹ä»¶                        |
| FOCUS               | __cc_focus_event                             | ç„¦ç‚¹äº‹ä»¶                           |
| GAME_CONTROLLER     | __cc_controller                              | æ¸¸æˆæ‰‹æŸ„äº‹ä»¶                         |
| CUSTOM              | ->getEventName()                             | è‡ªå®šä¹‰äº‹ä»¶ï¼Œä»¥EventNameå‚æ•°ä½œä¸ºlistenerID |

## æ³¨å†Œä¸ç®¡ç†è®¢é˜…è€…
EventDispatcheræä¾›äº†ä¸€äº›æ³¨å†Œå’Œç®¡ç†è®¢é˜…è€…çš„æ¥å£ï¼Œå¯¹è®¢é˜…è€…çš„ç®¡ç†å¤§æ¦‚å¯ä»¥åˆ†ä¸º3ç»„:
- æ³¨å†Œ
- åˆ é™¤
- ä¿®æ”¹

### æ³¨å†Œè®¢é˜…è€…
ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ¥æ³¨å†Œä¸€ä¸ªè®¢é˜…è€…ï¼š

```cpp
void addEventListenerWithSceneGraphPriority(EventListener* listener, Node* node);
void addEventListenerWithFixedPriority(EventListener* listener, int fixedPriority);
```

å…¶ä¸­**node**å‚æ•°æˆ–**fixedPriority**å‚æ•°ç”¨æ¥å†³å®šå¯¹åŒä¸€ä¸ªäº‹ä»¶æºçš„å¤šä¸ªè®¢é˜…è€…åº”è¯¥æŒ‰ç…§æ€æ ·çš„é¡ºåºåˆ†å‘äº‹ä»¶ã€‚EventDispatcheråˆ†å‘äº‹ä»¶çš„é¡ºåºæ˜¯ï¼š**priority<0, scene grapgh(priority=0), priority>0**ã€‚å…·ä½“å±•å¼€ä¸ºï¼š
- é¦–å…ˆåˆ†å‘ä¼˜å…ˆçº§å°äº0çš„è®¢é˜…è€…ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä»å°åˆ°å¤§çš„é¡ºåºåˆ†å‘
- ç„¶ååˆ†å‘æ‰€æœ‰ä¸Nodeå…ƒç´ å…³è”çš„è®¢é˜…è€…ï¼ŒæŒ‰ç…§å…³è”çš„Nodeåœ¨UIåœºæ™¯ä¸­çš„å±‚çº§ä»å‰å¾€ååˆ†å‘
- æœ€ååˆ†å‘ä¼˜å…ˆçº§å¤§äº0çš„è®¢é˜…è€…ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä»å°åˆ°å¤§çš„é¡ºåºåˆ†å‘

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ‰€æœ‰ä¸Nodeå…³è”çš„è®¢é˜…è€…ä¼˜å…ˆçº§éƒ½è¢«è®¾ç½®ä¸º0ï¼Œè€Œå¼€å‘è€…æ— æ³•æ³¨å†Œä¸€ä¸ªä¼˜å…ˆçº§ä¸º0çš„è®¢é˜…è€…ã€‚

### åˆ é™¤è®¢é˜…è€…
å½“ä¸€ä¸ªè®¢é˜…è€…ä¸å†éœ€è¦æ¥å—äº‹ä»¶é€šçŸ¥ï¼Œä»¥åŠè¯¥è®¢é˜…è€…è¢«é”€æ¯çš„æ—¶å€™ï¼Œå¼€å‘è€…éœ€è¦å‘EventDispatcheråˆ é™¤è¯¥è®¢é˜…è€…ï¼Œå¦åˆ™å°†å¯¼è‡´è®¢é˜…è€…çš„æŒ‡é’ˆä¸ºç©ºï¼Œå¯¼è‡´é‡æŒ‡é’ˆæ“ä½œã€‚  
EventDispatcheræä¾›äº†ä¸€ç»„æ–¹æ³•ç”¨äºåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªè®¢é˜…è€…ï¼š

```cpp
void removeEventListener(EventListener* listener);
void removeEventListenersForType(EventListener::Type listenerType);
void removeEventListenersForTarget(Node* target, bool recursive = false);
void removeCustomEventListeners(const std::string& customEventName);
void removeAllEventListeners();
```

- `removeEventListenersForType`ä¼šåˆ é™¤æ‰€æœ‰ç±»å‹ä¸ºlistenerTypeçš„è®¢é˜…è€…ï¼Œå½“ç§»é™¤typeä¸ºEventListener::Type::CUSTOMçš„è®¢é˜…è€…æ—¶ï¼Œä¼šç§»é™¤æ‰€æœ‰è‡ªå®šä¹‰äº‹ä»¶çš„è®¢é˜…è€…
- å¯ä»¥ä½¿ç”¨`removeCustomEventListeners`å•ç‹¬åˆ é™¤æŸä¸€ç±»è‡ªå®šä¹‰äº‹ä»¶ç±»å‹çš„è®¢é˜…è€…
- å¯¹äºä¸ä¸€ä¸ªNodeå…ƒç´ å…³è”çš„è®¢é˜…è€…ï¼Œå®ƒä»¬ä¼šåœ¨è¯¥Nodeå…ƒç´ è¢«ç§»é™¤çš„æ—¶å€™è‡ªåŠ¨åˆ é™¤ä¸è¯¥Nodeå…³è”çš„æ‰€æœ‰è®¢é˜…è€…

### ä¿®æ”¹è®¢é˜…è€…

#### å¯¹äºåœºæ™¯å›¾ä¼˜å…ˆçº§
å½“Nodeå…ƒç´ çš„**onEnter**æ–¹æ³•å’Œ**onExit**æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒå°†æ¢å¤å’Œæš‚åœæ‰€æœ‰çš„åŠ¨ç”»ã€è®¡æ—¶æ›´æ–°ï¼Œä»¥åŠæ‰€æœ‰ä¸ä¹‹å…³è”çš„äº‹ä»¶è®¢é˜…è€…ã€‚å¯¹äºäº‹ä»¶è®¢é˜…è€…å®ƒä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ¥å…³é—­å’Œå¼€å¯è®¢é˜…è€…æ˜¯å¦æ¥å—äº‹ä»¶é€šçŸ¥ï¼š

```cpp
void pauseEventListenersForTarget(Node* target, bool recursive = false);
void resumeEventListenersForTarget(Node* target, bool recursive = false);
```

#### å¯¹äºå›ºå®šå€¼ä¼˜å…ˆçº§
æƒ³è¦å¼€å¯å’Œå…³é—­ä½¿ç”¨ä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§å®šä¹‰çš„è®¢é˜…è€…ï¼Œéœ€è¦ä½¿ç”¨setEnableæ–¹æ³•ï¼š

```cpp
class CC_DLL EventListener : public Ref
{
public:
    void setEnabled(bool enabled) { _isEnabled = enabled; }
    bool isEnabled() const { return _isEnabled; }
};
```

å¯ä»¥é€šè¿‡**setPriorityæ–¹æ³•**æ¥ä¿®æ”¹è®¢é˜…è€…çš„ä¼˜å…ˆçº§ï¼š

```cpp
void setPriority(EventListener* listener, int fixedPriority);
```

ä½†æ˜¯ï¼Œæ— æ³•åŠ¨æ€åˆ¤æ–­ä¸€ä¸ªè®¢é˜…è€…æ˜¯åœºæ™¯å›¾ä¼˜å…ˆçº§è¿˜æ˜¯å›ºå®šå€¼ä¼˜å…ˆçº§ï¼Œå› ä¸º**getAssociatedNode**æ˜¯protectedæ–¹æ³•ã€‚

## äº‹ä»¶çš„åˆ†å‘
Eventå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶ç±»å‹ï¼Œä»¥åŠå¤„ç†è¯¥äº‹ä»¶ç›¸å…³çš„ä¸€äº›æ•°æ®ï¼ŒEventDispatcherèƒ½å¤Ÿæ ¹æ®Eventçš„ç±»å‹æ‰¾åˆ°ä¸ä¹‹åŒ¹é…çš„è®¢é˜…è€…è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚æ‰€ä»¥ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦æ„é€ ä¸€ä¸ªé€‚å½“çš„Eventç±»

```cpp
void dispatchEvent(Event* event);
```
å¯¹äºè‡ªå®šä¹‰äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’ä¸€ä¸ªäº‹ä»¶åç§°åŠä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œç”±EventDispatcherå¸®åŠ©æ„é€ ä¸€ä¸ªEventCustomå¯¹è±¡ã€‚

```cpp
void dispatchCustomEvent(const std::string &eventName, void *optionalUserData = nullptr);
```
EventCustomçš„å®šä¹‰å¦‚ä¸‹ï¼š

```cpp
class CC_DLL EventCustom : public Event
{
public:
    EventCustom(const std::string& eventName);
    void setUserData(void* data) { _userData = data; }
    void* getUserData() const { return _userData; }

    const std::string& getEventName() const { return _eventName; }
protected:
    void* _userData;
    std::string _eventName;
};
```

### åˆ†å‘çš„è¿‡ç¨‹
å…ˆçœ‹ä¸€çœ¼dispatchEventå‡½æ•°ï¼Œç®€è¦åˆ†æä¸€ä¸‹äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ã€‚
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

```cpp
void EventDispatcher::dispatchEvent(Event* event)
{
    if (!_isEnabled)
        return;

    // å¯¹_dirtyNodesä¸­çš„nodeå…³è”çš„æ‰€æœ‰ç›‘å¬å™¨çš„IDç½®è„æ ‡è®°
    updateDirtyFlagForSceneGraph();

    // è®°å½•å½“å‰åµŒå¥—çš„æ·±åº¦
    DispatchGuard guard(_inDispatch);

    // å¦‚æœæ˜¯è§¦æ‘¸äº‹ä»¶ï¼Œè°ƒç”¨è§¦æ‘¸ä¸“ç”¨çš„åˆ†å‘å‡½æ•°
    if (event->getType() == Event::Type::TOUCH)
    {
        dispatchTouchEvent(static_cast<EventTouch*>(event));
        return;
    }

    auto listenerID = __getListenerID(event);

    // å¯¹å½“å‰äº‹ä»¶ç±»å‹å¯¹åº”çš„listenerIDè®¢é˜…è€…è¿›è¡Œæ’åº
    sortEventListeners(listenerID);

    // å‡½æ•°æŒ‡é’ˆpfnDispatchEventToListenersæ ¹æ®äº‹ä»¶IDæ˜¯å¦æ˜¯é¼ æ ‡ç±»å‹æŒ‡å‘ä¸åŒçš„å‡½æ•°
    auto pfnDispatchEventToListeners = &EventDispatcher::dispatchEventToListeners;
    if (event->getType() == Event::Type::MOUSE) {
        pfnDispatchEventToListeners = &EventDispatcher::dispatchTouchEventToListeners;
    }
    // æ‰§è¡Œå›è°ƒå‡½æ•°å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†
    auto iter = _listenerMap.find(listenerID);
    if (iter != _listenerMap.end())
    {
        auto listeners = iter->second;

        auto onEvent = [&event](EventListener* listener) -> bool{
            event->setCurrentTarget(listener->getAssociatedNode());
            listener->_onEvent(event);
            return event->isStopped();
        };

        (this->*pfnDispatchEventToListeners)(listeners, onEvent);
    }
    
    // æ”¶å°¾å¤„ç†
    updateListeners(event);
}
```

</details>

- å¯¹_dirtyNodesä¸­çš„nodeå…³è”çš„æ‰€æœ‰ç›‘å¬å™¨çš„IDç½®è„æ ‡è®°
- è®°å½•å½“å‰åµŒå¥—çš„æ·±åº¦
- å¦‚æœæ˜¯è§¦æ‘¸äº‹ä»¶ï¼Œè°ƒç”¨è§¦æ‘¸ä¸“ç”¨çš„åˆ†å‘å‡½æ•°
- å¯¹å½“å‰äº‹ä»¶ç±»å‹å¯¹åº”çš„listenerIDè®¢é˜…è€…è¿›è¡Œæ’åº
- å‡½æ•°æŒ‡é’ˆpfnDispatchEventToListenersæ ¹æ®äº‹ä»¶IDæ˜¯å¦æ˜¯é¼ æ ‡ç±»å‹æŒ‡å‘ä¸åŒçš„å‡½æ•°
- æ‰§è¡Œå›è°ƒå‡½æ•°å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†
- æ”¶å°¾å¤„ç†

### è®¢é˜…è€…çš„æ’åº

è®¢é˜…è€…çš„ä¼˜å…ˆçº§æˆ–è€…ç›¸å…³è”Nodeçš„å±‚çº§å¯èƒ½ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–ï¼Œä¸ºäº†ä¿è¯ï¼š
- äº‹ä»¶åˆ†å‘èƒ½å¤ŸæŒ‰æ­£ç¡®çš„é¡ºåºè¿›è¡Œ
- å°½é‡é¿å…é¢‘ç¹çš„é‡æ–°æ’åºå¸¦æ¥åˆ†å‘çš„æ€§èƒ½é—®é¢˜

EventDispatcheré‡‡å–äº†ä¸€ç§ç­–ç•¥æ¥å¯¹è®¢é˜…è€…è¿›è¡Œæ’åºï¼š
- åœ¨**å˜åŠ¨æ—¶**æ ‡è®°ï¼Œå°†ç›¸åº”çš„è®¢é˜…è€…ä¿å­˜åˆ°ä¸€ä¸ª**dirtyè¡¨**
- åœ¨**åˆ†å‘å‰**é‡æ–°æ’åº
- åªå¯¹**å½“å‰äº‹ä»¶ç±»å‹**å¯¹åº”çš„listenerIDè®¢é˜…è€…è¿›è¡Œæ’åº

ä¸‹è¡¨åˆ—å‡ºå½±å“è®¢é˜…è€…é‡æ–°æ’åºçš„ä¸€äº›æ“ä½œï¼š

| æ“ä½œ                    | Nodeè®¢é˜…è€… | Priorityè®¢é˜…è€… | æè¿°                |
| --------------------- |:-------:|:-----------:| ----------------- |
| setLocalZOrder        | +       |             | ä¿®æ”¹Nodeçš„ç›¸å¯¹å±‚çº§       |
| setGlobalZOrder       | +       |             | ä¿®æ”¹Nodeçš„å…¨å±€å±‚çº§       |
| setPriority           |         | +           | ä¿®æ”¹Priorityè®¢é˜…è€…çš„ä¼˜å…ˆçº§ |
| forceAddEventListener | +       | +           | æ³¨å†Œè®¢é˜…è€…             |
| removeEventListener   | +       | +           | åˆ é™¤è®¢é˜…è€…             |

EventDispatcheråªå¯¹å½“å‰æ­£å¤„ç†çš„äº‹ä»¶ç±»å‹å¯¹åº”çš„è®¢é˜…è€…è¿›è¡Œæ’åºï¼Œå…·ä½“çš„sortEventListenerså‡½æ•°ä»£ç å¦‚ä¸‹ï¼š

```cpp
void EventDispatcher::sortEventListeners(const EventListener::ListenerID& listenerID)
{
    DirtyFlag dirtyFlag = DirtyFlag::NONE;

    auto dirtyIter = _priorityDirtyFlagMap.find(listenerID);
    if (dirtyIter != _priorityDirtyFlagMap.end())
    {
        dirtyFlag = dirtyIter->second;
    }

    if (dirtyFlag != DirtyFlag::NONE)
    {
        // Clear the dirty flag first, if `rootNode` is nullptr, then set its dirty flag of scene graph priority
        dirtyIter->second = DirtyFlag::NONE;
Â Â Â Â Â Â 
        // å¯¹å›ºå®šå€¼ä¼˜å…ˆçº§çš„listenersè¿›è¡Œæ’åº
        if ((int)dirtyFlag & (int)DirtyFlag::FIXED_PRIORITY)
        {
            sortEventListenersOfFixedPriority(listenerID);
        }

        // å¯¹åœºæ™¯å›¾ä¼˜å…ˆçº§çš„listenersè¿›è¡Œæ’åº
        if ((int)dirtyFlag & (int)DirtyFlag::SCENE_GRAPH_PRIORITY)
        {
            auto rootNode = Director::getInstance()->getRunningScene();
            if (rootNode)
            {
                sortEventListenersOfSceneGraphPriority(listenerID, rootNode);
            }
            else
            {
                dirtyIter->second = DirtyFlag::SCENE_GRAPH_PRIORITY;
            }
        }
    }
}
```

`sortEventListenersOfFixedPriority`å‡½æ•°å°±ä¸ç”¨ç»†è¯´ï¼Œå°±æ˜¯ä¸€ä¸ª**stable_sort**ã€‚è¿™é‡Œå±•å¼€è¯´ä¸€ä¸‹`sortEventListenersOfSceneGraphPriority`å‡½æ•°ã€‚

#### sortEventListenersOfSceneGraphPriorityå‡½æ•°

```cpp
void EventDispatcher::sortEventListenersOfSceneGraphPriority(const EventListener::ListenerID& listenerID, Node* rootNode)
{
    auto listeners = getListeners(listenerID);

    if (listeners == nullptr)
        return;
    auto sceneGraphListeners = listeners->getSceneGraphPriorityListeners();

    if (sceneGraphListeners == nullptr)
        return;

    // Reset priority index
    _nodePriorityIndex = 0;
    _nodePriorityMap.clear();

    visitTarget(rootNode, true);

    // After sort: priority < 0, > 0
    std::stable_sort(sceneGraphListeners->begin(), sceneGraphListeners->end(), [this](const EventListener* l1, const EventListener* l2) {
        return _nodePriorityMap[l1->getAssociatedNode()] > _nodePriorityMap[l2->getAssociatedNode()];
    });
}
```

åŒå›ºå®šä¼˜å…ˆçº§listenerçš„æ’åºä¸€æ ·ï¼Œéœ€å…ˆè·å–å®¹å™¨ã€‚ä¸åŒä¹‹å¤„åœ¨äºsceneGraphListenerså®¹å™¨é‡Œçš„ç›‘å¬å™¨ä¼˜å…ˆçº§éƒ½ä¸º0ï¼Œæ’åºéœ€è¦æŒ‰ç…§nodeçš„é¡ºåºã€‚

- ä½¿ç”¨_nodePriorityIndexå®¹å™¨è®°å½•nodeçš„ä¼˜å…ˆçº§
- `visitTarget`å‡½æ•°å°†è®¡ç®—å¥½çš„nodeå’Œnodeä¼˜å…ˆçº§å­˜å‚¨åœ¨_nodePriorityMap
- å¯¹sceneGraphListenersè¿›è¡Œæ’åºï¼Œæ’åºä¾ç…§æ¯ä¸ªç›‘å¬å™¨å…³è”çš„nodeåœ¨_nodePriorityMapçš„ä¼˜å…ˆçº§å¤§å°ï¼Œnodeä¼˜å…ˆçº§å¤§ï¼Œç›‘å¬å™¨æ’åºåœ¨å‰

#### visitTargetå‡½æ•°

ç®€è¦çš„è¯´ï¼Œå°†è®¡ç®—å¥½çš„nodeå’Œnodeä¼˜å…ˆçº§å­˜å‚¨åœ¨**\_nodePriorityMap**
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary>

```cpp
void EventDispatcher::visitTarget(Node* node, bool isRootNode)
{
    node->sortAllChildren();

    int i = 0;
    auto& children = node->getChildren();

    auto childrenCount = children.size();

    if(childrenCount > 0)
    {
        Node* child = nullptr;
        // visit children zOrder < 0
        for( ; i < childrenCount; i++ )
        {
            child = children.at(i);

            if ( child && child->getLocalZOrder() < 0 )
                visitTarget(child, false);
            else
                break;
        }

        if (_nodeListenersMap.find(node) != _nodeListenersMap.end())
        {
            _globalZOrderNodeMap[node->getGlobalZOrder()].push_back(node);
        }

        for( ; i < childrenCount; i++ )
        {
            child = children.at(i);
            if (child)
                visitTarget(child, false);
        }
    }
    else
    {
        if (_nodeListenersMap.find(node) != _nodeListenersMap.end())
        {
            _globalZOrderNodeMap[node->getGlobalZOrder()].push_back(node);
        }
    }

    if (isRootNode)
    {
        std::vector<float> globalZOrders;
        globalZOrders.reserve(_globalZOrderNodeMap.size());

        for (const auto& e : _globalZOrderNodeMap)
        {
            globalZOrders.push_back(e.first);
        }

        std::stable_sort(globalZOrders.begin(), globalZOrders.end(), [](const float a, const float b){
            return a < b;
        });

        for (const auto& globalZ : globalZOrders)
        {
            for (const auto& n : _globalZOrderNodeMap[globalZ])
            {
                _nodePriorityMap[n] = ++_nodePriorityIndex;
            }
        }

        _globalZOrderNodeMap.clear();
    }
}
```

</details>

- å¯¹nodeçš„å­èŠ‚ç‚¹è¿›è¡Œ**ç¨³å®šæ’åº**ï¼Œæ’åºåå­èŠ‚ç‚¹æŒ‰**LocalZOrder**ä»å°åˆ°å¤§æ’åˆ—
- å¯¹childrenè¿›è¡Œ**ä¸­åºéå†**ï¼Œéå†åˆ°çš„nodeçš„globalZOrderå’Œnodeå­˜å…¥**\_globalZOrderNodeMap**ä¸­ï¼Œæ­¤æ—¶mapä¸­çš„æ¯ä¸ªnodeå®¹å™¨ä¸­nodeéƒ½æ˜¯æŒ‰LocalZOrderä»å°åˆ°å¤§æ’åˆ—
- å¯¹äºåœºæ™¯èŠ‚ç‚¹ï¼Œè·å–åœºæ™¯ä¸­æ‰€æœ‰èŠ‚ç‚¹globalZOrderï¼Œå¹¶å¯¹globalZOrderä»å°åˆ°å¤§æ’åº
- æŒ‰globalZOrderä»å°åˆ°å¤§çš„é¡ºåºéå†_globalZOrderNodeMapï¼Œè·å–æ¯ä¸ªnodeï¼Œç›¸åŒglobalZOrderåˆ™æŒ‰å…ˆåé¡ºåºï¼ˆLocalZOrderä»å°åˆ°å¤§ï¼‰éå†
- æŒ‰éå†çš„é¡ºåºï¼Œå°†nodeä¾æ¬¡æ·»åŠ åˆ°**\_nodePriorityMap**ã€‚ä¼˜å…ˆçº§æŒ‰nodeçš„é¡ºåºä¾æ¬¡+1ã€‚å³ï¼Œè¶Šæ™šç»˜åˆ¶çš„nodeä¼˜å…ˆçº§è¶Šé«˜

å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œçš„æ’åºæ˜¯æœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—çš„ï¼Œæ‰€ä»¥cocos2dxåªå¯¹é‚£äº›è¢«ç”¨ä½œå…³è”è®¢é˜…è€…çš„Nodeçš„ç»˜åˆ¶é¡ºåºå‘ç”Ÿå˜æ›´æ—¶æ‰è¿›è¡Œæ ‡è®°ä»¥é‡æ–°æ’åºï¼Œè¿™ä¹ŸåŒ…æ‹¬Nodeçš„æŸä¸€çº§**å­å…ƒç´ **è¢«ç”¨ä½œå…³è”è®¢é˜…è€…çš„æƒ…å½¢ã€‚

### åµŒå¥—äº‹ä»¶

äº‹ä»¶çš„åˆ†å‘æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œå³åœ¨ä¸€ä¸ªåµŒå¥—äº‹ä»¶è§¦å‘å¦å¤–ä¸€ä¸ªäº‹ä»¶ã€‚
- cocos2dxä½¿ç”¨ä¸€ä¸ª**\_inDispatch**æ¥ä¿å­˜å½“å‰åµŒå¥—çš„æ·±åº¦ï¼Œå…¶å€¼ä¸º0æ—¶è¡¨ç¤ºæ²¡æœ‰äº‹ä»¶åœ¨åˆ†å‘
- æ¯æ¬¡è°ƒç”¨åˆ†å‘äº‹ä»¶æ—¶ï¼Œ**dispatchEvent**å‡½æ•°ä½¿ç”¨ä¸€ä¸ªè‡ªåŠ¨å˜é‡**DispatchGuard**æ¥è®°å½•å½“å‰åˆ†å‘çš„æ·±åº¦ï¼Œ**DispatchGuard**ä¼šå¯¹_inDispatchæ‰§è¡Œ+1ï¼Œå¹¶åœ¨å˜é‡ç”Ÿå‘½å‘¨æœŸç»“æŸå‡1
- åœ¨ä¸€ä¸ªåµŒå¥—äº‹ä»¶ä¸­æ‰§è¡Œä¸€ä¸ªç›¸åŒçš„äº‹ä»¶å¯èƒ½ä¼šå¯¼è‡´**æ­»å¾ªç¯**

```cpp
class DispatchGuard
{
public:
    DispatchGuard(int& count):
            _count(count)
    {
        ++_count;
    }

    ~DispatchGuard()
    {
        --_count;
    }

private:
    int& _count;
};
```

### åœ¨äº‹ä»¶åˆ†å‘ä¸­ä¿®æ”¹è®¢é˜…è€…
- åœ¨å½“å‰åµŒå¥—æ·±åº¦å†…ï¼Œä»»ä½•å¯¼è‡´å¯¹è®¢é˜…è€…ä¼˜å…ˆçº§çš„æ›´æ”¹ä¸ä¼šå½±å“åˆ°åé¢è®¢é˜…è€…çš„åˆ†å‘é¡ºåºï¼Œå› ä¸ºå¯¹è®¢é˜…è€…çš„é‡æ–°æ’åºæ˜¯åœ¨dispatchEventä¸­å¼€å§‹æ‰§è¡Œåˆ†å‘ä¹‹å‰æ‰§è¡Œçš„
- å¯¹ä¼˜å…ˆçº§çš„ä¿®æ”¹å°†åœ¨ä¸‹ä¸€ä¸ªåµŒå¥—æ·±åº¦å†…ç”Ÿæ•ˆï¼Œå› ä¸ºæ–°çš„äº‹ä»¶åˆ†å‘ä¼šé‡æ–°å¯¹è®¢é˜…è€…æ’åº
- ä»»ä½•å¯¹åç»­è®¢é˜…è€…çš„ä¿®æ”¹ï¼Œä½¿å¾—å…¶ä¸ºä¸å¯å¤„ç†äº‹ä»¶æ—¶ï¼Œå°†ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè¿™åŒ…æ‹¬é€šè¿‡`setEnable()`ã€`setPaused()`ä»¥åŠ`setRegistered()`æ–¹æ³•ä¿®æ”¹è®¢é˜…è€…ï¼Œå‚è§å¦‚ä¸‹åˆ†å‘äº‹ä»¶çš„æ–¹æ³•

```cpp
void EventDispatcher::dispatchEventToListeners(EventListenerVector* listeners, const std::function<bool(EventListener*)>& onEvent)
{
    bool shouldStopPropagation = false;
    auto fixedPriorityListeners = listeners->getFixedPriorityListeners();
    auto sceneGraphPriorityListeners = listeners->getSceneGraphPriorityListeners();
    
    ssize_t i = 0;
    // priority < 0
    if (fixedPriorityListeners)
    {
        CCASSERT(listeners->getGt0Index() <= static_cast<ssize_t>(fixedPriorityListeners->size()), "Out of range exception!");
        
        if (!fixedPriorityListeners->empty())
        {
            for (; i < listeners->getGt0Index(); ++i)
            {
                auto l = fixedPriorityListeners->at(i);
                if (l->isEnabled() && !l->isPaused() && l->isRegistered() && onEvent(l))
                {
                    shouldStopPropagation = true;
                    break;
                }
            }
        }
    }
}
```

- åœ¨åˆ†å‘è¿‡ç¨‹ä¸­ç§»é™¤ä¸€ä¸ªè®¢é˜…è€…å¹¶ä¸ä¼šç›´æ¥ä»è®¢é˜…è€…åˆ—è¡¨ç§»é™¤ï¼Œè€Œæ˜¯å°†å…¶æ ‡è®°ä¸º`setRegistered(false)`,ä½¿å¾—è¯¥è®¢é˜…è€…åœ¨åˆ†å‘è¿‡ç¨‹ä¸­ä¸å†ç”Ÿæ•ˆï¼Œè€Œåœ¨åˆ†å‘ç»“æŸæ—¶å°†å…¶ç§»é™¤
- åœ¨åˆ†å‘è¿‡ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªè®¢é˜…è€…ï¼Œä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ˜¯æ·»åŠ åˆ°ä¸€ä¸ªä¸´æ—¶çš„_toAddListenersæ•°ç»„ä¸­ï¼Œåœ¨æ‰€æœ‰äº‹ä»¶åˆ†å‘ç»“æŸåæ‰åŠ å…¥è®¢é˜…è€…åˆ—è¡¨
- å½“æ‰€æœ‰åµŒå¥—çš„äº‹ä»¶åˆ†å‘ç»“æŸï¼Œä»¥åŠ_inDispatchå˜ä¸º0æ—¶ï¼ŒEventDispatcherå¼€å§‹æ›´æ–°äº‹ä»¶åˆ†å‘è¿‡ç¨‹ä¸­å¯¹è®¢é˜…è€…åˆ—è¡¨çš„ä¿®æ”¹ï¼š
  - ç§»é™¤é‚£äº›registeredè¢«æ ‡è®°ä¸ºfalseçš„è®¢é˜…è€…
  - åˆ é™¤_listenerMapä¸­Vectorä¸ºç©ºçš„å…ƒç´ 
  - æ·»åŠ _toAddListenerså®¹å™¨çš„è®¢é˜…è€…åˆ°_listenerMap
  - æ·»åŠ æ‰€æœ‰å¾…æ·»åŠ å®¹å™¨_toAddedListenersé‡Œçš„ç›‘å¬å™¨
  - åˆ é™¤å¾…åˆ é™¤å®¹å™¨_toRemovedListenersé‡Œçš„ç›‘å¬å™¨

### åœæ­¢åˆ†å‘äº‹ä»¶
åœ¨ä¸€ä¸ªäº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„è®¢é˜…è€…å¯ä»¥é€‰æ‹©è®©äº‹ä»¶åœæ­¢ç»§ç»­ä¼ æ’­ï¼Œè¿™å¯ä»¥é€šè¿‡è°ƒç”¨Eventçš„`StopPropagation()`æ¥å®ç°ã€‚

```cpp
class CC_DLL Event : public Ref
{
public:    
    /** Stops propagation for current event.
     */
    void stopPropagation() { _isStopped = true; }
}
```

## äº‹ä»¶ä¸Node
é™¤äº†å‰æ–‡ä¸­[å¯¹Nodeçš„ä¸€äº›æ“ä½œ](###è®¢é˜…è€…çš„æ’åº)ä¼šå½±å“åˆ°EventDispatcherå¯¹è®¢é˜…è€…çš„åˆ†å‘å¤–ï¼ŒNodeç±»è¿˜ä»å¦å¤–ä¸¤ä¸ªæ–¹é¢å½±å“ç€äº‹ä»¶åˆ†å‘ã€‚

### æš‚åœä¸æ¢å¤

Nodeå…ƒç´ é™¤äº†ç”¨æ¥æ˜¾ç¤ºåœºæ™¯ï¼Œè¿˜ç”¨æ¥æ‰§è¡Œ3ç§é€»è¾‘ç›¸å…³çš„æ“ä½œï¼šåŠ¨ç”»(Action)ã€æ›´æ–°å›è°ƒ(Schedule)å’Œäº‹ä»¶ï¼ˆEventï¼‰ã€‚åœ¨ä¸€äº›çŠ¶å†µä¸‹ï¼Œéœ€è¦è®©ä¸€ä¸ªNodeå…ƒç´ åœæ­¢å¤„ç†è¿™äº›æ“ä½œï¼Œå³ä½¿å®ƒä»ç„¶æ˜¾ç¤ºåœ¨åœºæ™¯ä¸­ã€‚

cocos2dxæä¾›äº†ä¸¤ç§æ–¹æ³•ç”¨æ¥æš‚åœä¸æ¢å¤è¿™äº›æ“ä½œçš„æ‰§è¡Œï¼Œåˆ†åˆ«æ˜¯`pause()`æ–¹æ³•å’Œ`resume()`æ–¹æ³•ã€‚

```cpp
void Node::resume()
{
    _scheduler->resumeTarget(this);
    _actionManager->resumeTarget(this);
    _eventDispatcher->resumeEventListenersForTarget(this);
}

void Node::pause()
{
    _scheduler->pauseTarget(this);
    _actionManager->pauseTarget(this);
    _eventDispatcher->pauseEventListenersForTarget(this);
}
```

- å¯ä»¥åœ¨ä»»ä½•æ—¶é—´é˜»æ­¢æˆ–å…è®¸ä»»ä½•ä¸è¯¥Nodeç›¸å…³è”çš„è®¢é˜…è€…æ¥å—äº‹ä»¶é€šçŸ¥ï¼Œä½†æ˜¯è¿™ä¼šåŒæ—¶å½±å“æ›´æ–°å›è°ƒå’ŒåŠ¨ç”»çš„æ‰§è¡Œ
- å¦‚æœä»…ä»…åªæ˜¯æƒ³æ§åˆ¶ä¸äº‹ä»¶ç›¸å…³çš„é€»è¾‘ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨`resumeEventListenersForTarget()`å’Œ`pauseEventListenersForTarget()`æ–¹æ³•
- åœ¨Nodeå…ƒç´ å†…éƒ¨ï¼Œå½“`onEnter()`å’Œ`onExit()`æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šåˆ†åˆ«è°ƒç”¨`resume()`å’Œ`pause()`æ–¹æ³•

### åˆ é™¤è®¢é˜…è€…

Nodeå…ƒç´ åœ¨è¢«é‡Šæ”¾çš„æ—¶å€™ä¼šè‡ªåŠ¨ç§»é™¤æ‰€æœ‰ä¸è¯¥Nodeå…³è”çš„è®¢é˜…è€…ï¼Œé™¤ééœ€è¦æå‰ç§»é™¤æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨ç®¡ç†è®¢é˜…è€…çš„ç§»é™¤ã€‚

```cpp
Node::~Node()
{
    _eventDispatcher->removeEventListenersForTarget(this);
}
```